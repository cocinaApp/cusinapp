<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="validacion" content="330612543629-s9si36emg3ovr6s91bbdjodjdnfo9b8h.apps.googleusercontent.com">
</head>
<body>
    <div id="login">
        <form id="login-form">
            <h2>Iniciar Sesión</h2>
            <input type="text" id="username" placeholder="Nombre de Usuario" required>
            <input type="password" id="password" placeholder="Contraseña" required>
            <button type="submit">Iniciar Sesión</button>
        </form>
        <div class="g-signin2" data-onsuccess="onSignIn"></div>
    </div>

    <script>
        function onSignIn(googleUser) {
            // Obtener el perfil de usuario
            var profile = googleUser.getBasicProfile();
            console.log('ID: ' + profile.getId()); // No envíes esta información al backend
            console.log('Name: ' + profile.getName());
            console.log('Image URL: ' + profile.getImageUrl());
            console.log('Email: ' + profile.getEmail()); // Esta información debe ser validada en el backend
            
            // Envía la información al servidor para validación
            fetch('/validate-google-login', {
                method: 'POST',
                body: JSON.stringify({ id_token: googleUser.getAuthResponse().id_token }),
                headers: { 'Content-Type': 'application/json' }
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      window.location.href = "/dashboard"; // Redirige al dashboard
                  } else {
                      alert('Google Sign-In failed: ' + data.message);
                  }
              });
        }
    </script>
</body>
</html>
